@* 
*@

@using System.Linq
@using Contract_Monthly_Claim_System.Models

@{
    ViewData["Title"] = "Dashboard";
    // ensure coordinator partial always receives a non-null model
    var coordinatorClaims = ViewBag.CoordinatorClaims as IEnumerable<Claim> ?? Enumerable.Empty<Claim>();
}
<div class="container">

    <!-- Dashboard Welcome Section -->
    <div class="dashboard-welcome">
        <h1><i class="fas fa-file-contract"></i> Contract Monthly Claim System</h1>
        <p>Welcome to the Contract Monthly Claim System</p>
    </div>

    <!-- Role Switcher -->
    <div class="role-switcher">
        <label for="roleSwitch"><i class="fas fa-user-tag"></i> Switch Role:</label>
        <select id="roleSwitch" onchange="onRoleChange()" class="form-control">
            <option value="Lecturer">Lecturer</option>
            <option value="Program Coordinator">Program Coordinator</option>
            <option value="Academic Manager">Academic Manager</option>
        </select>
    </div>

    <hr class="mt-20" />

    <!-- Role Views Inline (only one visible at a time) -->
    <div id="lecturerView" class="role-view">
        <h3><i class="fas fa-chalkboard-teacher"></i> Lecturer Dashboard</h3>
        @await Html.PartialAsync("LectureDashboard", (IEnumerable<Claim>)ViewBag.LecturerClaims)
    </div>
    <div id="coordinatorView" class="role-view hidden">
        <h3><i class="fas fa-user-cog"></i> Coordinator Dashboard</h3>
        @* pass a non-null model to the partial *@
        @await Html.PartialAsync("CoordinatorDashboard", coordinatorClaims)
    </div>
    <div id="managerView" class="role-view hidden">
        <h3><i class="fas fa-briefcase"></i> Manager Dashboard</h3>
        @await Html.PartialAsync("ManagerDashboard", (IEnumerable<Claim>)ViewBag.ManagerClaims)
    </div>
</div>
<script>
    // Show default role view on page load (client-side only; switching actually logs out)
    function switchRoleView(role) {
        document.querySelectorAll(".role-view").forEach(v => v.classList.add("hidden"));
        if (role === "Lecturer") document.getElementById("lecturerView").classList.remove("hidden");
        if (role === "Program Coordinator") document.getElementById("coordinatorView").classList.remove("hidden");
        if (role === "Academic Manager") document.getElementById("managerView").classList.remove("hidden");
    }

    // Called when the user intentionally changes the selected role.
    // Updated: do NOT log out or navigate. Simply switch the visible view.
    function onRoleChange() {
        const role = document.getElementById('roleSwitch').value;
        switchRoleView(role);
    }

    // Initialize default visible pane without logging out
    (function init() {
        switchRoleView("Lecturer");
    })();

    // no-op
</script>