@model IEnumerable<Contract_Monthly_Claim_System.Models.Claim>
<style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Dashboard Welcome */
        .dashboard-welcome {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-left: 5px solid #e74c3c;
        }

            .dashboard-welcome h1 {
                color: #2c3e50;
                margin-bottom: 10px;
                font-size: 2.2rem;
            }

            .dashboard-welcome p {
                color: #7f8c8d;
                font-size: 1.1rem;
            }

            .dashboard-welcome i {
                color: #e74c3c;
                margin-right: 15px;
            }

        /* Overview Stats */
        .overview-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-top: 4px solid;
        }

            .stat-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            }

            .stat-card i {
                font-size: 2.5rem;
                margin-bottom: 15px;
            }

            .stat-card h3 {
                font-size: 2.2rem;
                margin-bottom: 10px;
                font-weight: 700;
            }

            .stat-card p {
                color: #7f8c8d;
                font-size: 1rem;
                font-weight: 600;
            }

            .stat-card.total {
                border-color: #3498db;
            }

                .stat-card.total i {
                    color: #3498db;
                }

                .stat-card.total h3 {
                    color: #3498db;
                }

            .stat-card.pending {
                border-color: #f39c12;
            }

                .stat-card.pending i {
                    color: #f39c12;
                }

                .stat-card.pending h3 {
                    color: #f39c12;
                }

            .stat-card.approved {
                border-color: #27ae60;
            }

                .stat-card.approved i {
                    color: #27ae60;
                }

                .stat-card.approved h3 {
                    color: #27ae60;
                }

            .stat-card.budget {
                border-color: #9b59b6;
            }

                .stat-card.budget i {
                    color: #9b59b6;
                }

                .stat-card.budget h3 {
                    color: #9b59b6;
                }

        /* Pending Claims Section */
        .pending-claims {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 15px;
        }

            .section-header h2 {
                color: #2c3e50;
                font-size: 1.6rem;
            }

            .section-header i {
                color: #e74c3c;
                margin-right: 15px;
                font-size: 1.3rem;
            }

        /* Claims Table */
        .claims-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

            .claims-table th {
                background: linear-gradient(135deg, #2c3e50, #34495e);
                color: white;
                padding: 18px 15px;
                text-align: left;
                font-weight: 600;
                font-size: 0.95rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .claims-table td {
                padding: 16px 15px;
                border-bottom: 1px solid #ecf0f1;
                color: #2c3e50;
            }

            .claims-table tr {
                transition: background-color 0.3s ease;
            }

                .claims-table tr:hover {
                    background: #f8f9fa;
                }

                .claims-table tr:last-child td {
                    border-bottom: none;
                }

        /* Status Badges */
        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
            text-align: center;
            min-width: 100px;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-approved {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            min-width: 80px;
        }

        .btn-approve {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }

            .btn-approve:hover {
                background: linear-gradient(135deg, #229954, #27ae60);
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
            }

        .btn-reject {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

            .btn-reject:hover {
                background: linear-gradient(135deg, #c0392b, #e74c3c);
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
            }

        .btn-view {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

            .btn-view:hover {
                background: linear-gradient(135deg, #2980b9, #3498db);
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
            }

        /* Forms in table */
        .claims-table form {
            display: inline;
            margin: 0;
        }

        .claims-table .btn {
            margin: 2px;
        }

        /* Responsive Design */
        @@media (max-width: 1200px) {
            .container

        {
            padding: 15px;
        }

        .claims-table {
            font-size: 0.9rem;
        }

            .claims-table th,
            .claims-table td {
                padding: 12px 10px;
            }

        }

        @@media (max-width: 768px) {
            .dashboard-welcome h1

        {
            font-size: 1.8rem;
        }

        .overview-stats {
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-card {
            padding: 20px;
        }

            .stat-card h3 {
                font-size: 1.8rem;
            }

        .section-header h2 {
            font-size: 1.4rem;
        }

        /* Horizontal scroll for table on mobile */
        .pending-claims {
            overflow-x: auto;
        }

        .claims-table {
            min-width: 800px;
        }

        .action-buttons {
            flex-direction: column;
            min-width: 120px;
        }

        .btn {
            min-width: 100%;
            justify-content: center;
        }

        }

        @@media (max-width: 480px) {
            .overview-stats

        {
            grid-template-columns: 1fr;
        }

        .dashboard-welcome {
            padding: 20px;
        }

        .pending-claims {
            padding: 20px;
        }

        .stat-card h3 {
            font-size: 1.6rem;
        }

        }

        /* Loading and empty states */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

            .empty-state i {
                font-size: 4rem;
                margin-bottom: 20px;
                color: #bdc3c7;
            }

        /* Animation for new rows */
        @@keyframes highlightNew {
            0%

        {
            background-color: #d4edda;
        }

        100% {
            background-color: transparent;
        }

        }

        .new-row {
            animation: highlightNew 2s ease;
        }
    </style>
    <div class="container">
        <div class="role-switcher" style="margin-bottom: 16px; display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
            <label for="roleSwitch" style="margin:0; font-weight:600;"><i class="fas fa-user-tag"></i> Switch View:</label>
            <select id="roleSwitch" class="form-control" style="max-width: 260px;"
                    data-mgr="@Url.Action("ManagerDashboard","Home")"
                    data-coo="@Url.Action("CoordinatorDashboard","Home")"
                    data-lec="@Url.Action("LectureDashboard","Home")"
                    onchange="(function(sel){var v=sel.value;var mgr=sel.dataset.mgr;var coo=sel.dataset.coo;var lec=sel.dataset.lec;location.href=(v==='coordinator'?coo:(v==='lecturer'?lec:mgr));})(this)">
                <option value="manager" selected>Manager</option>
                <option value="coordinator">Program Coordinator</option>
                <option value="lecturer">Lecturer</option>
            </select>
            <div class="btn-group" role="group" aria-label="Switch View Links">
                <a href="@Url.Action("ManagerDashboard","Home")" class="btn btn-sm btn-outline-secondary">Manager</a>
                <a href="@Url.Action("CoordinatorDashboard","Home")" class="btn btn-sm btn-outline-secondary">Coordinator</a>
                <a href="@Url.Action("LectureDashboard","Home")" class="btn btn-sm btn-outline-secondary">Lecturer</a>
            </div>
        </div>
        <div id="managerView" class="role-view">
        <!-- Dashboard Welcome -->
        <div class="dashboard-welcome">
            <h1><i class="fas fa-chart-line"></i> Academic Manager Dashboard</h1>
            <p>Welcome, Academic Manager! Oversee all claim activities and system performance.</p>
        </div>

        <!-- Overview Stats (dynamic) -->
        <div class="overview-stats">
            <div class="stat-card total">
                <i class="fas fa-file-invoice-dollar"></i>
                <h3>@Model.Count()</h3>
                <p>Total Claims</p>
            </div>

            <div class="stat-card pending">
                <i class="fas fa-clock"></i>
                <h3>@Model.Count(c => c.Status == "Pending")</h3>
                <p>Pending Approval</p>
            </div>

            <div class="stat-card approved">
                <i class="fas fa-check-circle"></i>
                <h3>@Model.Count(c => c.Status == "Approved")</h3>
                <p>Approved Claims</p>
            </div>

            <div class="stat-card budget">
                <i class="fas fa-money-bill-wave"></i>
                <h3>@String.Format("R {0:N2}", Model.Where(c => c.Status == "Approved").Sum(c => c.Total))</h3>
                <p>Total Processed</p>
            </div>
        </div>

        <!-- Pending Claims Section -->
        <div class="pending-claims">
            <div class="section-header">
                <h2><i class="fas fa-clock"></i> Claims Pending Your Approval</h2>
            </div>

            <!-- Desktop Table View -->
            <table class="claims-table">
                <thead>
                    <tr>
                        <th>Claim ID</th>
                        <th>Lecturer</th>
                        <th>Date Submitted</th>
                        <th>Description</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="manager-claims-body">
                    @foreach (var claim in Model)
                    {
                        @await Html.PartialAsync("~/Views/Claims/_ClaimRow.cshtml", claim)
                    }
                </tbody>
            </table>

            <!-- Mobile Card View removed for simplicity -->
        </div>

        <!-- Budget Overview removed -->
        <!-- Analytics removed -->
        <!-- Department Performance removed -->
        </div>
    </div>

    <!-- Modal removed for simplified UI -->

<script>
        // Modal removed

        // SignalR: live updates for manager table
        const mgrConn = new signalR.HubConnectionBuilder().withUrl("/claimHub").build();
        mgrConn.on("ReceiveClaimStatusUpdate", function (claimId, status) {
            const row = document.getElementById('claim-row-' + claimId);
            if (row) {
                const badge = document.getElementById('claim-status-' + claimId);
                if (badge) {
                    badge.textContent = status;
                    badge.className = 'status-badge ' + (status === 'Pending' ? 'status-pending' : status === 'Approved' ? 'status-approved' : status === 'Rejected' ? 'status-rejected' : '');
                }
            } else {
                fetch(`/Claims/Row/${claimId}`, { credentials: 'include' }) // <- ensure auth cookie sent
                    .then(r => r.text())
                    .then(html => {
                        const tmp = document.createElement('tbody');
                        tmp.innerHTML = html.trim();
                        const newRow = tmp.querySelector('tr');
                        const body = document.getElementById('manager-claims-body');
                        if (newRow && body) {
                            newRow.classList.add('new-row');
                            body.prepend(newRow);
                            // Remove highlight after animation
                            setTimeout(() => {
                                newRow.classList.remove('new-row');
                            }, 2000);
                        }
                    })
                    .catch(err => console.error('Manager row fetch failed', err));
            }
        });
        mgrConn.start().catch(e => console.error(e));

        // Role switcher: navigate to dashboards to avoid embedded CSS/JS conflicts
        document.addEventListener('DOMContentLoaded', function () {
            const roleSwitch = document.getElementById('roleSwitch');
            if (!roleSwitch) return;
            roleSwitch.addEventListener('change', function () {
                const v = this.value;
                if (v === 'coordinator') {
                    window.location.href = '/Home/CoordinatorDashboard';
                } else if (v === 'lecturer') {
                    window.location.href = '/Home/LectureDashboard';
                } else {
                    window.location.href = '/Home/ManagerDashboard';
                }
            });
        });

        // AJAX-submit Approve/Reject forms to prevent navigation
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('#manager-claims-body form[method="post"]').forEach(form => {
                form.addEventListener('submit', function (e) {
                    e.preventDefault();
                    const formData = new FormData(this);
                    const action = this.getAttribute('action');
                    const claimId = formData.get('id');
                    fetch(action, {
                        method: 'POST',
                        body: formData,
                        credentials: 'include', // <- include auth cookie
                        headers: {
                            'RequestVerificationToken': this.querySelector('input[name="__RequestVerificationToken"]').value,
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    }).then(resp => {
                        if (resp.ok) {
                            const newStatus = action.includes('Approve') ? 'Approved' : 'Rejected';
                            const badge = document.getElementById('claim-status-' + claimId);
                            if (badge) {
                                badge.textContent = newStatus;
                                badge.className = 'status-badge ' + (newStatus === 'Pending' ? 'status-pending' : newStatus === 'Approved' ? 'status-approved' : 'status-rejected');
                            }
                        } else {
                            alert('Error updating claim status');
                        }
                    }).catch(err => {
                        console.error(err);
                        alert('Error updating claim status');
                    });
                });
            });
        });
    </script>